
file(GLOB PROTOFILES *.proto)

SET(PROTO_META_BASE_DIR ${CMAKE_CURRENT_BINARY_DIR})
LIST(APPEND PROTO_FLAGS -I${CMAKE_CURRENT_SOURCE_DIR})

FOREACH(FIL ${PROTOFILES})

	GET_FILENAME_COMPONENT(ABS_FIL ${FIL} ABSOLUTE)
	GET_FILENAME_COMPONENT(FIL_WE ${FIL} NAME_WE)
	
	LIST(APPEND BAR_SRC "${CMAKE_CURRENT_BINARY_DIR}/${FIL_WE}.pb.cc")
	LIST(APPEND BAR_HEADER "${CMAKE_CURRENT_BINARY_DIR}/${FIL_WE}.pb.h")

	EXECUTE_PROCESS(
		COMMAND ${PROTOBUF_PROTOC_EXECUTABLE} ${PROTO_FLAGS} --cpp_out=${PROTO_META_BASE_DIR} ${FIL}
		WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
		)

ENDFOREACH()


#PROTOBUF_GENERATE_CPP(PROTO_SRC PROTO_HEADER ${PROTOFILES})
#
#
#set(PROTOBUF_INCLUDE_DIRS ${PROTOBUF_INCLUDE_DIRS} PARENT_SCOPE)
#set(PROTOBUF_LIBRARIES  ${PROTOBUF_LIBRARIES} PARENT_SCOPE)
#set(PROTO_SRC ${PROTO_SRC} PARENT_SCOPE)
#set(PROTO_HEADER ${PROTO_HEADER} PARENT_SCOPE)



